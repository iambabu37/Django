<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container mt-5" style="max-width: 400px;">
    <h2>Login</h2>
    {% if form.errors %}
    <div class="alert alert-danger">Invalid username or password.</div>
    {% endif %}
    <form method="post" novalidate>
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary w-100">Log In</button>
    </form>
    <p class="mt-3">Don't have an account? <a href="{% url 'signup' %}">Sign up here</a></p>
</div>


<script>
document.getElementById("loginForm").addEventListener("submit", function(e){
  e.preventDefault();

  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  fetch("/api/token/", {
    method: "POST",
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({email: email, password: password})
  })
  .then(res => {
    if (!res.ok) throw new Error("Invalid login");
    return res.json();
  })
  .then(data => {
    localStorage.setItem("access_token", data.access);
    localStorage.setItem("refresh_token", data.refresh);
    alert("Login successful!");
    // Redirect or update UI accordingly
  })
  .catch(err => alert(err.message));
});
</script>
